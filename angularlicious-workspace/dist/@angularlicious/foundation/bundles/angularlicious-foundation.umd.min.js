!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common"),require("@angularlicious/logging"),require("@angularlicious/rules-engine"),require("rxjs"),require("@angularlicious/actions"),require("@angular/router"),require("@angular/common/http")):"function"==typeof define&&define.amd?define("@angularlicious/foundation",["exports","@angular/core","@angular/common","@angularlicious/logging","@angularlicious/rules-engine","rxjs","@angularlicious/actions","@angular/router","@angular/common/http"],t):t((e.angularlicious=e.angularlicious||{},e.angularlicious.foundation={}),e.ng.core,e.ng.common,null,null,e.rxjs,null,e.ng.router,e.ng.common.http)}(this,function(e,t,r,a,i,c,o,n,s){"use strict";var g=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{imports:[a.AngularliciousLoggingModule,r.CommonModule,i.AngularliciousRulesEngineModule]}]}],e}(),l=function(){this.IsSuccess=!1,this.Errors=new Array},u=function(){function e(e){this.loggingService=e,this.accessToken="",this.serviceContext=new i.ServiceContext}return e.prototype.extractData=function(e){return e.json()||{}},e.prototype.handleUnexpectedError=function(e){var t=new i.ServiceMessage(e.name,e.message).WithDisplayToUser(!0).WithMessageType(i.MessageType.Error).WithSource(this.serviceName),r=t.toString()+"; "+e.stack;this.loggingService.log(this.serviceName,a.Severity.Error,r),this.serviceContext.addMessage(t)},e.prototype.handleError=function(e){var t=new i.ServiceMessage(e.name,e.message).WithDisplayToUser(!0).WithMessageType(i.MessageType.Error).WithSource(this.serviceName);this.loggingService.log(this.serviceName,a.Severity.Error,t.toString()),this.serviceContext.addMessage(t)},e.prototype.handleHttpError=function(e,t){var r=e.toString()+" "+t.requestUrl+", "+JSON.stringify(t.body);if(this.loggingService.log(this.serviceName,a.Severity.Error,r),e&&e._body)try{var i=e.json();return new c.BehaviorSubject(i).asObservable()}catch(e){this.loggingService.log(this.serviceName,a.Severity.Error,e.toString())}var o=this.createErrorResponse("Unexpected error while processing response.");return new c.BehaviorSubject(o).asObservable()},e.prototype.handleOAuthError=function(e,t){var r=e.toString()+" "+t.requestUrl+", "+JSON.stringify(t.body);if(this.loggingService.log(this.serviceName,a.Severity.Error,r),e&&e._body)try{var i=this.createErrorResponse("Unable to validate credentials.");return new c.BehaviorSubject(i).asObservable()}catch(n){this.loggingService.log(this.serviceName,a.Severity.Error,n.toString())}var o=this.createErrorResponse("Unable to validate credentials.");return new c.BehaviorSubject(o).asObservable()},e.prototype.createErrorResponse=function(e){var t=new l;return t.Message=e,t},e.prototype.finishRequest=function(e){var t=this;this.loggingService.log(this.serviceName,a.Severity.Information,"Request for ["+e+"] by "+this.serviceName+" is complete."),this.serviceContext.hasErrors()&&(this.loggingService.log(this.serviceName,a.Severity.Information,"Preparing to write any messages."),this.serviceContext.Messages.filter(function(e){return e.MessageType===i.MessageType.Error&&e.DisplayToUser}).forEach(function(e){return t.loggingService.log(t.serviceName,a.Severity.Error,e.toString())}))},e.prototype.resetServiceContext=function(){this.loggingService.log(this.serviceName,a.Severity.Information,"Preparing to reset the Messages of the current [ServiceContext]."),this.serviceContext&&this.serviceContext.Messages?0<this.serviceContext.Messages.length?(this.loggingService.log(this.serviceName,a.Severity.Information,"Resetting the Messages of the current [ServiceContext]."),this.serviceContext.Messages=new Array):this.loggingService.log(this.serviceName,a.Severity.Information,"The current [ServiceContext] does not contain any [Messages]."):this.loggingService.log(this.serviceName,a.Severity.Warning,"The current [ServiceContext] is not valid."),this.loggingService.log(this.serviceName,a.Severity.Information,"Finished  processing request to [reset] the Messages of the current [ServiceContext].")},e.prototype.writeMessages=function(){var t=this;this.serviceContext&&this.serviceContext.Messages&&this.serviceContext.Messages.forEach(function(e){e.MessageType===i.MessageType.Error&&e.DisplayToUser&&t.loggingService.log(t.serviceName,a.Severity.Error,e.toString())})},e}(),h=function(e,t){return(h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};var v=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return function(e,t){function r(){this.constructor=e}h(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(t,e),t.prototype.validateAction=function(){return this.validationContext.renderRules()},t.prototype.postValidateAction=function(){var t=this;this.loggingService.log(this.actionName,a.Severity.Information,"Preparing to determine if the action contains validation errors in "+this.actionName),this.validationContext.hasRuleViolations()&&(this.loggingService.log(this.actionName,a.Severity.Information,"The target contains validation errors in "+this.actionName),this.validationContext.results.forEach(function(e){e.isValid||(t.publishRuleResult(e),t.retrieveRuleDetails(e))}))},t.prototype.postExecuteAction=function(){var t=this;this.actionResult===o.ActionResult.Fail&&this.serviceContext.Messages.forEach(function(e){e.MessageType===i.MessageType.Error&&t.loggingService.log(t.actionName,a.Severity.Error,e.toString())})},t.prototype.validateActionResult=function(){if(this.loggingService.log(this.actionName,a.Severity.Information,"Running [validateActionResult] for "+this.actionName+"."),this.validationContext.hasRuleViolations()){this.loggingService.log(this.actionName,a.Severity.Error,"The "+this.actionName+" contains rule violations."),this.actionResult=o.ActionResult.Fail;var e=new l;e.IsSuccess=!1,e.Message="Validation errors exist.",this.response=c.Observable["throw"](e)}return this.actionResult=this.serviceContext.isGood()?o.ActionResult.Success:o.ActionResult.Fail,this.actionResult},t.prototype.retrieveRuleDetails=function(e){var t=this;if(e.rulePolicy instanceof i.CompositeRule){var r=e.rulePolicy;if(r&&r.hasErrors)r.results.filter(function(e){return!e.isValid&&e.rulePolicy.isDisplayable}).forEach(function(e){t.publishRuleResult(e),e.rulePolicy instanceof i.CompositeRule&&t.retrieveRuleDetails(e)})}},t.prototype.publishRuleResult=function(e){var t=new i.ServiceMessage(e.rulePolicy.name,e.rulePolicy.message,i.MessageType.Error);t.DisplayToUser=e.rulePolicy.isDisplayable,t.Source=this.actionName,this.serviceContext.Messages.push(t),this.loggingService.log(this.actionName,a.Severity.Error,""+t.toString())},t}(o.Action),p=function(){function e(e){this.loggingService=e,this.loggingService.log(this.serviceName,a.Severity.Information,"Running constructor for the [BusinessProviderBase].")}return e.prototype.handleUnexpectedError=function(e){var t=new i.ServiceMessage(e.name,e.message).WithDisplayToUser(!0).WithMessageType(i.MessageType.Error).WithSource(this.serviceName),r=t.toString()+"; "+e.stack;this.loggingService.log(this.serviceName,a.Severity.Error,r),this.serviceContext.addMessage(t)},e.prototype.finishRequest=function(e){var t=this;this.loggingService.log(this.serviceName,a.Severity.Information,"Request for ["+e+"] by "+this.serviceName+" is complete."),this.serviceContext.hasErrors()&&(this.loggingService.log(this.serviceName,a.Severity.Information,"Preparing to write out the errors."),this.serviceContext.Messages.filter(function(e){return e.DisplayToUser&&e.MessageType===i.MessageType.Error}).forEach(function(e){return t.loggingService.log(t.serviceName,a.Severity.Error,e.toString())}))},e}(),f=function(){function e(){}return e.Information="alert-info",e.Warning="alert-warning",e.Danger="alert-danger",e.Success="alert-success",e}(),y=function(e,t,r,i){this.type=f.Information,this.messages=new Array,this.showAlert=!1,i&&(this.type=i),this.header=e,this.title=t,r&&(this.messages=r),this.header&&this.title&&(this.showAlert=!0)},S=function(){function e(e,t,r){var i=this;this.loggingService=t,this.router=r,this.componentName=e,this.alertNotification=new y("",""),this.router.events.subscribe(function(e){e instanceof n.NavigationEnd&&i.googleAnalyticsPageview(e)})}return e.prototype.googleAnalyticsSendEvent=function(e,t,r,i){window.gtag("event",t,{event_category:e,event_label:r,value:i})},e.prototype.googleAnalyticsPageview=function(e){if(e&&e.urlAfterRedirects){this.loggingService.log(this.componentName,a.Severity.Information,"Preparing to set [Google Analytics] page view for ["+e.urlAfterRedirects+"].");window.ga("config","UA-110194344-1",{page_title:this.componentName,page_path:e.urlAfterRedirects})}else this.loggingService.log(this.componentName,a.Severity.Warning,"Failed to set [Google Analytics] page view.")},e.prototype.createErrorResponse=function(e){this.loggingService.log(this.componentName,a.Severity.Information,"Preparing to create error response for component.");var t=new l;return t.Message=e,t},e.prototype.handleServiceErrors=function(e,t){if(this.loggingService.log(this.componentName,a.Severity.Information,"Preparing to handle service errors for component."),t&&t.hasErrors()){this.loggingService.log(this.componentName,a.Severity.Information,"Retrieving error messages from the ServiceContext/ValidationContext;");var r=this.retrieveServiceContextErrorMessages(t);this.alertNotification=new y("Errors",e.Message,r,f.Warning)}else if(e&&e.Message){this.loggingService.log(this.componentName,a.Severity.Information,"Retrieving error messages from the [ErrorResponse].");var i=this.retrieveResponseErrorMessages(e);this.alertNotification=new y("Error",e.Message,i,f.Warning),this.loggingService.log(this.componentName,a.Severity.Error,"Error: "+e.Message)}},e.prototype.retrieveServiceContextErrorMessages=function(e){var t=Array();return e.Messages.forEach(function(e){e.MessageType===i.MessageType.Error&&e.DisplayToUser&&t.push(e.Message)}),t},e.prototype.retrieveResponseErrorMessages=function(e){var t=new Array;return e&&e.Errors&&e.Errors.forEach(function(e){e.DisplayToUser&&t.push(e.Message)}),t},e.prototype.resetAlertNotifications=function(){this.alertNotification=new y("","")},e.prototype.routeTo=function(e){try{this.router.navigate([e])}catch(t){this.loggingService.log(this.componentName,a.Severity.Error,"Error while attempting to navigate to ["+e+"] route from "+this.componentName+". Error: "+t.toString())}},e.prototype.showResponseErrors=function(e){this.handleServiceErrors(e,undefined)},e.prototype.finishRequest=function(e){this.loggingService.log(this.componentName,a.Severity.Information,this.componentName+": "+e)},e.prototype.showAlertMessage=function(e){alert(e)},e}(),m=function(){},d={GET:0,POST:1,PUT:2,DELETE:3,OPTIONS:4,HEAD:5,PATCH:6};d[d.GET]="GET",d[d.POST]="POST",d[d.PUT]="PUT",d[d.DELETE]="DELETE",d[d.OPTIONS]="OPTIONS",d[d.HEAD]="HEAD",d[d.PATCH]="PATCH";var E=function(){function e(e,t){this.http=e,this.loggingService=t,this.serviceName="HttpBaseService"}return e.prototype.createMultipartFormDataHeader=function(e){this.loggingService.log(this.serviceName,a.Severity.Information,"Preparing to create header for the [multipart/form-data] HTTP request. RequiresAuthToken: "+e+".");var t=new s.HttpHeaders;return e&&t.append("Authorization","Bearer "+this.accessToken),t},e.prototype.createFormUrlencodedHeader=function(){return this.loggingService.log(this.serviceName,a.Severity.Information,"Preparing to create header for the [application/x-www-form-urlencoded] HTTP request."),new s.HttpHeaders({"Content-Type":"application/x-www-form-urlencoded"})},e.prototype.createHeader=function(e){this.loggingService.log(this.serviceName,a.Severity.Information,"Preparing to create header for the HTTP request. RequiresAuthToken: "+e+".");var t=new s.HttpHeaders({"Content-Type":"application/json"});return e&&t.append("Authorization","Bearer "+this.accessToken),t},e.prototype.createRequestOptions=function(e,t,r,i){this.loggingService.log(this.serviceName,a.Severity.Information,"Preparing to create request options for the HTTP request.");var o=new m;return o.headers=t,o.requestUrl=r,o.body=i,o},e.prototype.executeRequest=function(e){return this.loggingService.log(this.serviceName,a.Severity.Information,"Preparing to execute HTTP request. Url: "+e.requestUrl),this.http.request(e.requestMethod.toString(),e.requestUrl,e)},e.prototype.get=function(e){return e.requestMethod=d.GET,this.http.get(e.requestUrl,e).pipe()},e.prototype.post=function(e){return e.requestMethod=d.POST,this.http.post(e.requestUrl,e).pipe()},e.prototype.handleHttpError=function(e,t){var r=e.toString()+" "+t.requestUrl+", "+JSON.stringify(t.body);if(this.loggingService.log(this.serviceName,a.Severity.Error,r),!e||!e._body)return this.handleUnexpectedError(e);try{var i=e.json();return i?new c.BehaviorSubject(i).asObservable():this.handleUnexpectedError(e)}catch(s){var o=s,n=o.name+"; "+o.message;return this.loggingService.log(this.serviceName,a.Severity.Error,n),this.handleUnexpectedError(o)}},e.prototype.handleUnexpectedError=function(e){var t=this.createErrorResponse(e);return new c.BehaviorSubject(t).asObservable()},e.prototype.createErrorResponse=function(e){var t="Unexpected error while processing response.",r=new l;return e instanceof Error&&(t=e.name+" - "+e.message,r.Exception=e),r.Message=t,r},e.decorators=[{type:t.Injectable}],e.ctorParameters=function(){return[{type:s.HttpClient},{type:a.AngularliciousLoggingService}]},e}(),N=function(){},T=function(){this.Errors=new Array};e.AngularliciousFoundationModule=g,e.ServiceBase=u,e.ActionBase=v,e.BusinessProviderBase=p,e.ComponentBase=S,e.HttpBaseService=E,e.ErrorResponse=l,e.ServiceError=N,e.ServiceResponse=T,e.AlertNotification=y,e.AlertTypes=f,e.HttpRequestOptions=m,e.HttpRequestMethod=d,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=angularlicious-foundation.umd.min.js.map