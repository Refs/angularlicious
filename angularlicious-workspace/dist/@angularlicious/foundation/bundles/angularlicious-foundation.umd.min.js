!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/common"),require("@angularlicious/actions"),require("@angular/router"),require("@angularlicious/rules-engine"),require("@angular/core"),require("@angular/common/http"),require("rxjs"),require("@angularlicious/logging")):"function"==typeof define&&define.amd?define("@angularlicious/foundation",["exports","@angular/common","@angularlicious/actions","@angular/router","@angularlicious/rules-engine","@angular/core","@angular/common/http","rxjs","@angularlicious/logging"],t):t((e.angularlicious=e.angularlicious||{},e.angularlicious.foundation={}),e.ng.common,e.actions,e.ng.router,e.rulesEngine,e.ng.core,e.ng.common.http,e.rxjs,e.logging)}(this,function(e,t,r,o,n,i,s,a,c){"use strict";var g=function(){function e(){}return e.decorators=[{type:i.NgModule,args:[{imports:[c.AngularliciousLoggingModule,t.CommonModule,n.AngularliciousRulesEngineModule]}]}],e}(),l=function(e,t){return(l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function u(e,t){function r(){this.constructor=e}l(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var h=function w(){this.Errors=new Array},p=function(t){function e(){var e=t.call(this)||this;return e.IsSuccess=!1,e}return u(e,t),e}(h),v=function(){function e(e){this.loggingService=e,this.accessToken="",this.serviceContext=new n.ServiceContext}return e.prototype.extractData=function(e){return e.json()||{}},e.prototype.handleUnexpectedError=function(e){var t=new n.ServiceMessage(e.name,e.message).WithDisplayToUser(!0).WithMessageType(n.MessageType.Error).WithSource(this.serviceName),r=[""+this.serviceName],i=t.toString()+"; "+e.stack;this.loggingService.log(this.serviceName,c.Severity.Error,i,r),this.serviceContext.addMessage(t)},e.prototype.handleError=function(e){var t=new n.ServiceMessage(e.name,e.message).WithDisplayToUser(!0).WithMessageType(n.MessageType.Error).WithSource(this.serviceName),r=[""+this.serviceName];this.loggingService.log(this.serviceName,c.Severity.Error,t.toString(),r),this.serviceContext.addMessage(t)},e.prototype.handleHttpError=function(e,t){var r=e.toString()+" "+t.requestUrl+", "+JSON.stringify(t.body);if(this.loggingService.log(this.serviceName,c.Severity.Error,r),e&&e._body)try{var i=e.json();return new a.BehaviorSubject(i).asObservable()}catch(e){this.loggingService.log(this.serviceName,c.Severity.Error,e.toString())}var o=this.createErrorResponse("Unexpected error while processing response.");return new a.BehaviorSubject(o).asObservable()},e.prototype.handleOAuthError=function(e,t){var r=e.toString()+" "+t.requestUrl+", "+JSON.stringify(t.body);if(this.loggingService.log(this.serviceName,c.Severity.Error,r),e&&e._body)try{var i=this.createErrorResponse("Unable to validate credentials.");return new a.BehaviorSubject(i).asObservable()}catch(n){this.loggingService.log(this.serviceName,c.Severity.Error,n.toString())}var o=this.createErrorResponse("Unable to validate credentials.");return new a.BehaviorSubject(o).asObservable()},e.prototype.createErrorResponse=function(e){var t=new p;return t.Message=e,t},e.prototype.finishRequest=function(e){var t=this;this.loggingService.log(this.serviceName,c.Severity.Information,"Request for ["+e+"] by "+this.serviceName+" is complete."),this.serviceContext.hasErrors()&&(this.loggingService.log(this.serviceName,c.Severity.Information,"Preparing to write any messages."),this.serviceContext.Messages.filter(function(e){return e.MessageType===n.MessageType.Error&&e.DisplayToUser}).forEach(function(e){return t.loggingService.log(t.serviceName,c.Severity.Error,e.toString())}))},e.prototype.resetServiceContext=function(){this.loggingService.log(this.serviceName,c.Severity.Information,"Preparing to reset the Messages of the current [ServiceContext]."),this.serviceContext&&this.serviceContext.Messages?0<this.serviceContext.Messages.length?(this.loggingService.log(this.serviceName,c.Severity.Information,"Resetting the Messages of the current [ServiceContext]."),this.serviceContext.Messages=new Array):this.loggingService.log(this.serviceName,c.Severity.Information,"The current [ServiceContext] does not contain any [Messages]."):this.loggingService.log(this.serviceName,c.Severity.Warning,"The current [ServiceContext] is not valid."),this.loggingService.log(this.serviceName,c.Severity.Information,"Finished  processing request to [reset] the Messages of the current [ServiceContext].")},e.prototype.writeMessages=function(){var t=this;this.serviceContext&&this.serviceContext.Messages&&this.serviceContext.Messages.forEach(function(e){e.MessageType===n.MessageType.Error&&e.DisplayToUser&&t.loggingService.log(t.serviceName,c.Severity.Error,e.toString())})},e}(),f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return u(t,e),t.prototype.validateAction=function(){return this.validationContext.renderRules()},t.prototype.postValidateAction=function(){var t=this;this.loggingService.log(this.actionName,c.Severity.Information,"Preparing to determine if the action contains validation errors in "+this.actionName),this.validationContext.hasRuleViolations()&&(this.loggingService.log(this.actionName,c.Severity.Information,"The target contains validation errors in "+this.actionName),this.validationContext.results.forEach(function(e){e.isValid||(t.publishRuleResult(e),t.retrieveRuleDetails(e))}))},t.prototype.postExecuteAction=function(){var t=this;this.actionResult===r.ActionResult.Fail&&this.serviceContext.Messages.forEach(function(e){e.MessageType===n.MessageType.Error&&t.loggingService.log(t.actionName,c.Severity.Error,e.toString())})},t.prototype.validateActionResult=function(){if(this.loggingService.log(this.actionName,c.Severity.Information,"Running [validateActionResult] for "+this.actionName+"."),this.validationContext.hasRuleViolations()){this.loggingService.log(this.actionName,c.Severity.Error,"The "+this.actionName+" contains rule violations."),this.actionResult=r.ActionResult.Fail;var e=new p;e.IsSuccess=!1,e.Message="Validation errors exist.",this.response=a.Observable["throw"](e)}return this.actionResult=this.serviceContext.isGood()?r.ActionResult.Success:r.ActionResult.Fail,this.actionResult},t.prototype.retrieveRuleDetails=function(e){var t=this;if(e.rulePolicy instanceof n.CompositeRule){var r=e.rulePolicy;if(r&&r.hasErrors)r.results.filter(function(e){return!e.isValid&&e.rulePolicy.isDisplayable}).forEach(function(e){t.publishRuleResult(e),e.rulePolicy instanceof n.CompositeRule&&t.retrieveRuleDetails(e)})}},t.prototype.publishRuleResult=function(e){var t=new n.ServiceMessage(e.rulePolicy.name,e.rulePolicy.message,n.MessageType.Error);t.DisplayToUser=e.rulePolicy.isDisplayable,t.Source=this.actionName,this.serviceContext.Messages.push(t),this.loggingService.log(this.actionName,c.Severity.Error,""+t.toString())},t}(r.Action),y=function(){function e(e){this.loggingService=e,this.loggingService.log(this.serviceName,c.Severity.Information,"Running constructor for the [BusinessProviderBase].")}return e.prototype.handleUnexpectedError=function(e){var t=new n.ServiceMessage(e.name,e.message).WithDisplayToUser(!0).WithMessageType(n.MessageType.Error).WithSource(this.serviceName),r=t.toString()+"; "+e.stack;this.loggingService.log(this.serviceName,c.Severity.Error,r),this.serviceContext.addMessage(t)},e.prototype.finishRequest=function(e){var t=this;this.loggingService.log(this.serviceName,c.Severity.Information,"Request for ["+e+"] by "+this.serviceName+" is complete."),this.serviceContext.hasErrors()&&(this.loggingService.log(this.serviceName,c.Severity.Information,"Preparing to write out the errors."),this.serviceContext.Messages.filter(function(e){return e.DisplayToUser&&e.MessageType===n.MessageType.Error}).forEach(function(e){return t.loggingService.log(t.serviceName,c.Severity.Error,e.toString())}))},e}(),m=function(){function e(){}return e.Information="alert-info",e.Warning="alert-warning",e.Danger="alert-danger",e.Success="alert-success",e}(),S=function x(e,t,r,i){this.type=m.Information,this.messages=new Array,this.showAlert=!1,i&&(this.type=i),this.header=e,this.title=t,r&&(this.messages=r),this.header&&this.title&&(this.showAlert=!0)},d=function(){function e(e,t,r){var i=this;this.loggingService=t,this.router=r,this.componentName=e,this.alertNotification=new S("",""),this.router.events.subscribe(function(e){e instanceof o.NavigationEnd&&i.googleAnalyticsPageview(e)})}return e.prototype.googleAnalyticsSendEvent=function(e,t,r,i){window.gtag("event",t,{event_category:e,event_label:r,value:i})},e.prototype.googleAnalyticsPageview=function(e){if(e&&e.urlAfterRedirects){this.loggingService.log(this.componentName,c.Severity.Information,"Preparing to set [Google Analytics] page view for ["+e.urlAfterRedirects+"].");window.ga("config","UA-110194344-1",{page_title:this.componentName,page_path:e.urlAfterRedirects})}else this.loggingService.log(this.componentName,c.Severity.Warning,"Failed to set [Google Analytics] page view.")},e.prototype.createErrorResponse=function(e){this.loggingService.log(this.componentName,c.Severity.Information,"Preparing to create error response for component.");var t=new p;return t.Message=e,t},e.prototype.handleServiceErrors=function(e,t){if(this.loggingService.log(this.componentName,c.Severity.Information,"Preparing to handle service errors for component."),t&&t.hasErrors()){this.loggingService.log(this.componentName,c.Severity.Information,"Retrieving error messages from the ServiceContext/ValidationContext;");var r=this.retrieveServiceContextErrorMessages(t);this.alertNotification=new S("Errors",e.Message,r,m.Warning)}else if(e&&e.Message){this.loggingService.log(this.componentName,c.Severity.Information,"Retrieving error messages from the [ErrorResponse].");var i=this.retrieveResponseErrorMessages(e);this.alertNotification=new S("Error",e.Message,i,m.Warning),this.loggingService.log(this.componentName,c.Severity.Error,"Error: "+e.Message)}},e.prototype.retrieveServiceContextErrorMessages=function(e){var t=Array();return e.Messages.forEach(function(e){e.MessageType===n.MessageType.Error&&e.DisplayToUser&&t.push(e.Message)}),t},e.prototype.retrieveResponseErrorMessages=function(e){var t=new Array;return e&&e.Errors&&e.Errors.forEach(function(e){e.DisplayToUser&&t.push(e.Message)}),t},e.prototype.resetAlertNotifications=function(){this.alertNotification=new S("","")},e.prototype.routeTo=function(e){try{this.router.navigate([e])}catch(t){this.loggingService.log(this.componentName,c.Severity.Error,"Error while attempting to navigate to ["+e+"] route from "+this.componentName+". Error: "+t.toString())}},e.prototype.showResponseErrors=function(e){this.handleServiceErrors(e,undefined)},e.prototype.finishRequest=function(e){this.loggingService.log(this.componentName,c.Severity.Information,this.componentName+": "+e)},e.prototype.showAlertMessage=function(e){alert(e)},e}(),E=function T(){},N={get:0,post:1,put:2,"delete":3,options:4,head:5,patch:6};N[N.get]="get",N[N.post]="post",N[N.put]="put",N[N["delete"]]="delete",N[N.options]="options",N[N.head]="head",N[N.patch]="patch";var M=function(){function e(e,t){this.http=e,this.loggingService=t,this.serviceName="HttpBaseService"}return e.prototype.createMultipartFormDataHeader=function(e){this.loggingService.log(this.serviceName,c.Severity.Information,"Preparing to create header for the [multipart/form-data] HTTP request. RequiresAuthToken: "+e+".");var t=new s.HttpHeaders;return e&&t.append("Authorization","Bearer "+this.accessToken),t},e.prototype.createFormUrlencodedHeader=function(){return this.loggingService.log(this.serviceName,c.Severity.Information,"Preparing to create header for the [application/x-www-form-urlencoded] HTTP request."),new s.HttpHeaders({"Content-Type":"application/x-www-form-urlencoded"})},e.prototype.createHeader=function(e){this.loggingService.log(this.serviceName,c.Severity.Information,"Preparing to create header for the HTTP request. RequiresAuthToken: "+e+".");var t=new s.HttpHeaders({"Content-Type":"application/json"});return e&&t.append("Authorization","Bearer "+this.accessToken),t},e.prototype.createRequestOptions=function(e,t,r,i){this.loggingService.log(this.serviceName,c.Severity.Information,"Preparing to create request options for the HTTP request.");var o=new E;return o.headers=t,o.requestUrl=r,o.body=i,o},e.prototype.executeRequest=function(e){return this.loggingService.log(this.serviceName,c.Severity.Information,"Preparing to execute HTTP request. Url: "+e.requestUrl),this.http.request(e.requestMethod.toString(),e.requestUrl,e)},e.prototype.get=function(e){return e.requestMethod=N.get,this.http.get(e.requestUrl,e).pipe()},e.prototype.post=function(e){return this.http.options,this.http.post(e.requestUrl,e.body,{headers:e.headers}).pipe()},e.prototype.handleHttpError=function(e,t){var r=e.toString()+" "+t.requestUrl+", "+JSON.stringify(t.body);if(this.loggingService.log(this.serviceName,c.Severity.Error,r),!e||!e._body)return this.handleUnexpectedError(e);try{var i=e.json();return i?new a.BehaviorSubject(i).asObservable():this.handleUnexpectedError(e)}catch(s){var o=s,n=o.name+"; "+o.message;return this.loggingService.log(this.serviceName,c.Severity.Error,n),this.handleUnexpectedError(o)}},e.prototype.handleUnexpectedError=function(e){var t=this.createErrorResponse(e);return new a.BehaviorSubject(t).asObservable()},e.prototype.createErrorResponse=function(e){var t="Unexpected error while processing response.",r=new p;return e instanceof Error&&(t=e.name+" - "+e.message,r.Exception=e),r.Message=t,r},e.decorators=[{type:i.Injectable}],e.ctorParameters=function(){return[{type:s.HttpClient},{type:c.AngularliciousLoggingService}]},e}(),R=function b(){};e.AngularliciousFoundationModule=g,e.ServiceBase=v,e.ActionBase=f,e.BusinessProviderBase=y,e.ComponentBase=d,e.HttpBaseService=M,e.ErrorResponse=p,e.ServiceError=R,e.ServiceResponse=h,e.AlertNotification=S,e.AlertTypes=m,e.HttpRequestOptions=E,e.HttpRequestMethod=N,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=angularlicious-foundation.umd.min.js.map