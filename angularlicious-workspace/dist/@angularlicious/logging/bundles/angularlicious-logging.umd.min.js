!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports,require("@angular/common"),require("rxjs"),require("@angularlicious/rules-engine"),require("@angularlicious/configuration"),require("@angular/core"),require("ngx-loggly-logger")):"function"==typeof define&&define.amd?define("@angularlicious/logging",["exports","@angular/common","rxjs","@angularlicious/rules-engine","@angularlicious/configuration","@angular/core","ngx-loggly-logger"],i):i((t.angularlicious=t.angularlicious||{},t.angularlicious.logging={}),t.ng.common,t.rxjs,t.rulesEngine,t.configuration,t.ng.core,t.ngxLogglyLogger)}(this,function(t,i,e,n,r,s,g){"use strict";var o=function(){function t(){}return t.decorators=[{type:s.NgModule,args:[{imports:[i.CommonModule,n.AngularliciousRulesEngineModule,g.NgxLogglyModule.forRoot()],providers:[]}]}],t}(),a={Information:1,Warning:2,Error:3,Critical:4,Debug:5};a[a.Information]="Information",a[a.Warning]="Warning",a[a.Error]="Error",a[a.Critical]="Critical",a[a.Debug]="Debug";var u=function d(t,i,e,n,o){this.application=t,this.source=i,this.severity=e,this.message=n,this.timestamp=new Date(Date.now()),this.tags=o},l=function(){function t(t){var i=this;this.config=t,this.serviceName="LoggingService",this.applicationName="application",this.version="0.0.0",this.logEntries$=new e.ReplaySubject(1),this.timestamp=new Date(Date.now()),this.log(this.serviceName,a.Information,"Starting logging service at: "+this.timestamp),t&&this.config.settings$.subscribe(function(t){return i.setupConfiguration(t)})}return t.prototype.setupConfiguration=function(t){this.config&&this.config.settings&&this.config.settings.logging&&(this.loggingConfig=this.config.settings.logging,this.applicationName=this.loggingConfig&&this.loggingConfig.applicationName?this.loggingConfig.applicationName:"application",this.version=this.loggingConfig&&this.loggingConfig.version?this.loggingConfig.version:"0.0.0",this.isProduction=!(!this.loggingConfig||!this.loggingConfig.isProduction)&&this.loggingConfig.isProduction)},t.prototype.log=function(t,i,e,n){this.source=this.applicationName+"."+t,this.severity=i,this.message=e,this.timestamp=new Date(Date.now());var o=new u(this.applicationName,this.source,this.severity,this.message,n);this.logEntries$.next(o)},t.decorators=[{type:s.Injectable}],t.ctorParameters=function(){return[{type:r.ConfigurationService,decorators:[{type:s.Optional}]}]},t}(),c=function v(){this.applicationName="APP_NAME_NOT_PROVIDED"},h=function(){function t(){}return t.prototype.execute=function(){this.setup(),this.validateEntry()&&this.write(),this.finish()},t.prototype.validateEntry=function(){var t=new n.ValidationContext;return t.addRule(new n.IsTrue("LogWriterExists","The log writer is not configured.",this.hasWriter)),t.addRule(new n.IsNotNullOrUndefined("EntryIsNotNull","The entry cannot be null.",this.targetEntry)),t.addRule(new n.StringIsNotNullEmptyRange("SourceIsRequired","The entry source is not valid.",this.targetEntry.source,1,100)),t.addRule(new n.StringIsNotNullEmptyRange("MessageIsValid","The message is required for the [Log Entry].",this.targetEntry.message,1,2e3)),t.addRule(new n.IsNotNullOrUndefined("TimestampIsRequired","The timestamp must be a valid DateTime value.",this.targetEntry.timestamp)),t.renderRules().isValid},t.prototype.finish=function(){},t}(),p=function(t,i){return(p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])})(t,i)};function f(t,i){function e(){this.constructor=t}p(t,i),t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)}var y=function(e){function t(t){var i=e.call(this)||this;return i.loggingService=t,i.loggingService.logEntries$.subscribe(function(t){return i.handleLogEntry(t)}),i}return f(t,e),t.prototype.handleLogEntry=function(t){this.targetEntry=t,this.execute()},t.prototype.setup=function(){},t.prototype.write=function(){switch(this.targetEntry.severity){case a.Debug:console.debug(this.targetEntry);break;case a.Information:console.info(this.targetEntry);break;case a.Warning:console.warn(this.targetEntry);break;case a.Error:case a.Critical:console.error(this.targetEntry)}},t.decorators=[{type:s.Injectable}],t.ctorParameters=function(){return[{type:l}]},t}(h),m=function(o){function t(t,i,e){var n=o.call(this)||this;return n.configService=t,n.loggingService=i,n.loggly=e,n.configService&&n.loggingService&&(n.configService.settings$.subscribe(function(t){return n.handleSettings(t)}),n.loggingService.logEntries$.subscribe(function(t){return n.handleLogEntry(t)})),n}return f(t,o),t.prototype.handleSettings=function(t){t&&(this.hasWriter=!0,this.logglyConfig=t.loggly)},t.prototype.handleLogEntry=function(t){this.hasWriter&&(this.targetEntry=t,this.execute())},t.prototype.setup=function(){if(this.hasWriter&&(this.loggly.push({logglyKey:this.logglyConfig.apiKey,sendConsoleErrors:this.logglyConfig.sendConsoleErrors}),this.targetEntry.tags&&0<this.targetEntry.tags.length)){var t=this.targetEntry.tags.join(",");this.loggly.push({tag:t})}},t.prototype.write=function(){this.loggly.push(this.formatEntry(this.targetEntry))},t.prototype.formatEntry=function(t){return"application:"+t.application+"; source:"+t.source+"; timestamp:"+t.timestamp.toUTCString()+"; message:"+t.message},t.ctorParameters=function(){return[{type:r.ConfigurationService,decorators:[{type:s.Optional}]},{type:l},{type:g.LogglyService}]},t}(h);t.AngularliciousLoggingModule=o,t.AngularliciousLoggingService=l,t.LoggingServiceConfig=c,t.Severity=a,t.LogWriter=h,t.ConsoleWriter=y,t.LogglyWriter=m,t.LogEntry=u,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=angularlicious-logging.umd.min.js.map